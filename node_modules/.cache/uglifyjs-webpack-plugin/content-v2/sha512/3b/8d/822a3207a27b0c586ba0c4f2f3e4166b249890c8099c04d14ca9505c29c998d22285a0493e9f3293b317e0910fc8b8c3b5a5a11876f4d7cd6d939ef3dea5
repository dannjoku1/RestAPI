{"code":"module.exports=function(e){var r={};function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&r&&\"string\"!=typeof e)for(var i in e)t.d(n,i,function(r){return e[r]}.bind(null,i));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,\"a\",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p=\"\",t(t.s=4)}([function(e,r){e.exports=require(\"express\")},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0});const n={JWT_SECRET:\"thisisasecret\",MONGO_URL:\"mongodb://localhost/restapi-dev\"},i={MONGO_URL:\"mongodb://localhost/restapi-test\"},o={JWT_SECRET:\"thisisasecret\",MONGO_URL:\"mongodb://localhost/restapi-prod\"},a={PORT:process.env.PORT||3e3};r.default=Object.assign({},a,function(e){switch(e){case\"development\":return n;case\"test\":return i;default:return o}}(\"production\"))},function(e,r){e.exports=require(\"mongoose\")},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0}),r.passwordReg=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(t(19));const i=r.passwordReg=/(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{6,}/;r.default={signup:{email:n.default.string().email().required(),password:n.default.string().regex(i).required(),firstName:n.default.string().required(),lastName:n.default.string().required(),userName:n.default.string().required()}}},function(e,r,t){\"use strict\";var n=u(t(0)),i=u(t(1));t(5);var o=u(t(6)),a=u(t(12));function u(e){return e&&e.__esModule?e:{default:e}}const s=(0,n.default)();(0,o.default)(s),s.get(\"/\",(e,r)=>{r.send(\"Hello World\")}),(0,a.default)(s),s.listen(i.default.PORT,e=>{if(e)throw e;console.log(`\\n    Server is running on port: ${i.default.PORT}\\n    --------\\n    Running on production\\n    --------\\n    Let's get it!!\\n    `)})},function(e,r,t){\"use strict\";var n=o(t(2)),i=o(t(1));function o(e){return e&&e.__esModule?e:{default:e}}n.default.Promise=global.Promise;try{n.default.connect(i.default.MONGO_URL)}catch(e){n.default.createConnection(i.default.MONGO_URL)}n.default.connection.once(\"open\",()=>console.log(\"MongoDB Running\")).on(\"error\",e=>{throw e})},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0});var n=u(t(7)),i=(u(t(8)),u(t(9))),o=u(t(10)),a=u(t(11));function u(e){return e&&e.__esModule?e:{default:e}}r.default=(e=>{e.use((0,i.default)()),e.use((0,o.default)()),e.use(n.default.json()),e.use(n.default.urlencoded({extended:!0})),e.use(a.default.initialize())})},function(e,r){e.exports=require(\"body-parser\")},function(e,r){e.exports=require(\"morgan\")},function(e,r){e.exports=require(\"compression\")},function(e,r){e.exports=require(\"helmet\")},function(e,r){e.exports=require(\"passport\")},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(t(13)),i=t(20);r.default=(e=>{e.use(\"/api/v1/users\",n.default),e.get(\"/hello\",i.authJwt,(e,r)=>{r.send(\"This is a private route\")})})},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0});var n=t(0),i=s(t(14)),o=t(20),a=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}(t(15)),u=s(t(3));function s(e){return e&&e.__esModule?e:{default:e}}const f=new n.Router;f.post(\"/signup\",(0,i.default)(u.default.signup),a.signUp),f.post(\"/login\",o.authLocal,a.login),r.default=f},function(e,r){e.exports=require(\"express-validation\")},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0}),r.signUp=async function(e,r){try{const t=await n.default.create(e.body);return r.status(201).json(t)}catch(e){return r.status(500).json(e)}},r.login=function(e,r,t){return r.status(200).json(e.user),t()};var n=function(e){return e&&e.__esModule?e:{default:e}}(t(16))},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0});var n=t(2),i=c(n),o=c(t(17)),a=t(18),u=c(t(42)),s=t(3),f=c(t(1));function c(e){return e&&e.__esModule?e:{default:e}}const l=new n.Schema({email:{type:String,unique:!0,required:[!0,\"Email is required!\"],trim:!0,validate:{validator:e=>o.default.isEmail(e),message:\"{VALUE} is not a valid email!\"}},firstName:{type:String,required:[!0,\"First name is required\"],trim:!0},lastName:{type:String,required:[!0,\"Last name is required\"],trim:!0},userName:{type:String,required:[!0,\"Username is required\"],trim:!0},password:{type:String,required:[!0,\"Password is required!\"],trim:!0,minlength:[6,\"Password need to be longer!\"],validate:{validator:e=>s.passwordReg.test(e),message:\"{VALUE} is not a valid password!\"}}});l.pre(\"save\",function(e){return this.isModified(\"password\")&&(this.password=this._hashPassword(this.password)),e()}),l.methods={_hashPassword:e=>(0,a.hashSync)(e),authenticateUser(e){return(0,a.compareSync)(e,this.password)},createToken(){return u.default.sign({_id:this._id},f.default.JWT_SECRETS)},toJSON(){return{_id:this._id,userName:this.userName,token:`Passport-JWT ${this.createToken()}`}}},r.default=i.default.model(\"User\",l)},function(e,r){e.exports=require(\"validator\")},function(e,r){e.exports=require(\"bcrypt-nodejs\")},function(e,r){e.exports=require(\"joi\")},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0}),r.authJwt=r.authLocal=void 0;var n=s(t(11)),i=s(t(21)),o=t(37),a=s(t(16)),u=s(t(1));function s(e){return e&&e.__esModule?e:{default:e}}const f=new i.default({usernameField:\"email\"},async(e,r,t)=>{try{const n=await a.default.findOne({email:e});return n&&n.authenticateUser(r)?t(null,n):t(null,!1)}catch(e){return t(e,!1)}}),c={jwtFromRequest:o.ExtractJwt.fromAuthHeader(\"authorization\"),secretOrKey:u.default.JWT_SECRET},l=new o.Strategy(c,async(e,r)=>{try{const t=await a.default.findById(e._id);return r(null,t?t:!1)}catch(e){return r(e,!1)}});n.default.use(f),n.default.use(l);r.authLocal=n.default.authenticate(\"local\",{session:!1}),r.authJwt=n.default.authenticate(\"jwt\",{session:!1})},function(e,r){e.exports=require(\"passport-local\")},function(e,r){e.exports=require(\"util\")},function(e,r){e.exports=require(\"safe-buffer\")},function(e,r){var t=function(e,r){Error.call(this,e),Error.captureStackTrace(this,this.constructor),this.name=\"JsonWebTokenError\",this.message=e,r&&(this.inner=r)};(t.prototype=Object.create(Error.prototype)).constructor=t,e.exports=t},function(e,r,t){var n=t(43),i=t(48);r.ALGORITHMS=[\"HS256\",\"HS384\",\"HS512\",\"RS256\",\"RS384\",\"RS512\",\"ES256\",\"ES384\",\"ES512\"],r.sign=n.sign,r.verify=i.verify,r.decode=i.decode,r.isValid=i.isValid,r.createSign=function(e){return new n(e)},r.createVerify=function(e){return new i(e)}},function(e,r){e.exports=require(\"stream\")},function(e,r){e.exports=require(\"buffer\")},function(e,r,t){\"use strict\";var n=/(\\S+)\\s+(\\S+)/;e.exports={parse:function(e){if(\"string\"!=typeof e)return null;var r=e.match(n);return r&&{scheme:r[1],value:r[2]}}}},function(e,r){e.exports=require(\"url\")},function(e,r,t){var n=t(25);e.exports=function(e,r){r=r||{};var t=n.decode(e,r);if(!t)return null;var i=t.payload;if(\"string\"==typeof i)try{var o=JSON.parse(i);\"object\"==typeof o&&(i=o)}catch(e){}return!0===r.complete?{header:t.header,payload:i,signature:t.signature}:i}},function(e,r,t){var n=t(23).Buffer,i=t(26);function o(e){if(this.buffer=null,this.writable=!0,this.readable=!0,!e)return this.buffer=n.alloc(0),this;if(\"function\"==typeof e.pipe)return this.buffer=n.alloc(0),e.pipe(this),this;if(e.length||\"object\"==typeof e)return this.buffer=e,this.writable=!1,process.nextTick(function(){this.emit(\"end\",e),this.readable=!1,this.emit(\"close\")}.bind(this)),this;throw new TypeError(\"Unexpected data type (\"+typeof e+\")\")}t(22).inherits(o,i),o.prototype.write=function(e){this.buffer=n.concat([this.buffer,n.from(e)]),this.emit(\"data\",e)},o.prototype.end=function(e){e&&this.write(e),this.emit(\"end\",e),this.emit(\"close\"),this.writable=!1,this.readable=!1},e.exports=o},function(e,r,t){var n=t(44),i=t(23).Buffer,o=t(45),a=t(46),u=t(22),s=\"secret must be a string or buffer\",f=\"key must be a string or a buffer\",c=\"key must be a string, a buffer or an object\";function l(e){return e.replace(/=/g,\"\").replace(/\\+/g,\"-\").replace(/\\//g,\"_\")}function d(e){var r=[].slice.call(arguments,1),t=u.format.bind(u,e).apply(null,r);return new TypeError(t)}function p(e){return i.isBuffer(e)||\"string\"==typeof e}function h(e){return p(e)||(e=JSON.stringify(e)),e}function y(e){return function(r,t){if(!p(t))throw d(s);r=h(r);var n=o.createHmac(\"sha\"+e,t);return l((n.update(r),n.digest(\"base64\")))}}function v(e){return function(r,t,o){var a=y(e)(r,o);return n(i.from(t),i.from(a))}}function g(e){return function(r,t){if(!p(t)&&\"object\"!=typeof t)throw d(c);r=h(r);var n=o.createSign(\"RSA-SHA\"+e);return l((n.update(r),n.sign(t,\"base64\")))}}function m(e){return function(r,t,n){if(!p(n))throw d(f);r=h(r),t=function(e){var r=4-(e=e.toString()).length%4;if(4!==r)for(var t=0;t<r;++t)e+=\"=\";return e.replace(/\\-/g,\"+\").replace(/_/g,\"/\")}(t);var i=o.createVerify(\"RSA-SHA\"+e);return i.update(r),i.verify(n,t,\"base64\")}}function b(e){var r=g(e);return function(){var t=r.apply(null,arguments);return t=a.derToJose(t,\"ES\"+e)}}function w(e){var r=m(e);return function(t,n,i){return n=a.joseToDer(n,\"ES\"+e).toString(\"base64\"),r(t,n,i)}}function x(){return function(){return\"\"}}function S(){return function(e,r){return\"\"===r}}e.exports=function(e){var r={hs:y,rs:g,es:b,none:x},t={hs:v,rs:m,es:w,none:S},n=e.match(/^(RS|ES|HS)(256|384|512)$|^(none)$/i);if(!n)throw d('\"%s\" is not a valid algorithm.\\n  Supported algorithms are:\\n  \"HS256\", \"HS384\", \"HS512\", \"RS256\", \"RS384\", \"RS512\" and \"none\".',e);var i=(n[1]||n[3]).toLowerCase(),o=n[2];return{sign:r[i](o),verify:t[i](o)}}},function(e,r,t){var n=t(27).Buffer;e.exports=function(e){return\"string\"==typeof e?e:\"number\"==typeof e||n.isBuffer(e)?e.toString():JSON.stringify(e)}},function(e,r,t){var n=t(24),i=function(e,r){n.call(this,e),this.name=\"NotBeforeError\",this.date=r};(i.prototype=Object.create(n.prototype)).constructor=i,e.exports=i},function(e,r,t){var n=t(24),i=function(e,r){n.call(this,e),this.name=\"TokenExpiredError\",this.expiredAt=r};(i.prototype=Object.create(n.prototype)).constructor=i,e.exports=i},function(e,r,t){var n=t(50);e.exports=function(e,r){var t=r||Math.floor(Date.now()/1e3);if(\"string\"==typeof e){var i=n(e);if(void 0===i)return;return Math.floor(t+i/1e3)}return\"number\"==typeof e?t+e:void 0}},function(e,r,t){\"use strict\";var n=t(38),i=t(59);e.exports={Strategy:n,ExtractJwt:i}},function(e,r,t){var n=t(39),i=(t(28),t(22));t(29);function o(e,r){if(n.Strategy.call(this),this.name=\"jwt\",this._secretOrKey=e.secretOrKey,!this._secretOrKey)throw new TypeError(\"JwtStrategy requires a secret or key\");if(this._verify=r,!this._verify)throw new TypeError(\"JwtStrategy requires a verify callback\");if(this._jwtFromRequest=e.jwtFromRequest,!this._jwtFromRequest)throw new TypeError(\"JwtStrategy requires a function to retrieve jwt from requests (see option jwtFromRequest)\");this._passReqToCallback=e.passReqToCallback,this._verifOpts={},e.issuer&&(this._verifOpts.issuer=e.issuer),e.audience&&(this._verifOpts.audience=e.audience),e.algorithms&&(this._verifOpts.algorithms=e.algorithms),null!=e.ignoreExpiration&&(this._verifOpts.ignoreExpiration=e.ignoreExpiration)}i.inherits(o,n.Strategy),o.JwtVerifier=t(41),o.prototype.authenticate=function(e,r){var t=this,n=t._jwtFromRequest(e);if(!n)return t.fail(new Error(\"No auth token\"));o.JwtVerifier(n,this._secretOrKey,this._verifOpts,function(r,n){if(r)return t.fail(r);var i=function(e,r,n){return e?t.error(e):r?t.success(r,n):t.fail(n)};try{t._passReqToCallback?t._verify(e,n,i):t._verify(n,i)}catch(e){t.error(e)}})},e.exports=o},function(e,r){e.exports=require(\"passport-strategy\")},function(e,r){e.exports=require(\"xtend\")},function(e,r,t){var n=t(42);e.exports=function(e,r,t,i){return n.verify(e,r,t,i)}},function(e,r,t){e.exports={decode:t(30),verify:t(49),sign:t(51),JsonWebTokenError:t(24),NotBeforeError:t(34),TokenExpiredError:t(35)}},function(e,r,t){var n=t(23).Buffer,i=t(31),o=t(32),a=t(26),u=t(33),s=t(22);function f(e,r){return n.from(e,r).toString(\"base64\").replace(/=/g,\"\").replace(/\\+/g,\"-\").replace(/\\//g,\"_\")}function c(e){var r=e.header,t=e.payload,n=e.secret||e.privateKey,i=e.encoding,a=o(r.alg),c=function(e,r,t){t=t||\"utf8\";var n=f(u(e),\"binary\"),i=f(u(r),t);return s.format(\"%s.%s\",n,i)}(r,t,i),l=a.sign(c,n);return s.format(\"%s.%s\",c,l)}function l(e){var r=e.secret||e.privateKey||e.key,t=new i(r);this.readable=!0,this.header=e.header,this.encoding=e.encoding,this.secret=this.privateKey=this.key=t,this.payload=new i(e.payload),this.secret.once(\"close\",function(){!this.payload.writable&&this.readable&&this.sign()}.bind(this)),this.payload.once(\"close\",function(){!this.secret.writable&&this.readable&&this.sign()}.bind(this))}s.inherits(l,a),l.prototype.sign=function(){try{var e=c({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit(\"done\",e),this.emit(\"data\",e),this.emit(\"end\"),this.readable=!1,e}catch(e){this.readable=!1,this.emit(\"error\",e),this.emit(\"close\")}},l.sign=c,e.exports=l},function(e,r,t){\"use strict\";var n=t(27).Buffer,i=t(27).SlowBuffer;function o(e,r){if(!n.isBuffer(e)||!n.isBuffer(r))return!1;if(e.length!==r.length)return!1;for(var t=0,i=0;i<e.length;i++)t|=e[i]^r[i];return 0===t}e.exports=o,o.install=function(){n.prototype.equal=i.prototype.equal=function(e){return o(this,e)}};var a=n.prototype.equal,u=i.prototype.equal;o.restore=function(){n.prototype.equal=a,i.prototype.equal=u}},function(e,r){e.exports=require(\"crypto\")},function(e,r,t){\"use strict\";var n=t(23).Buffer,i=t(47),o=128,a=48,u=2;function s(e){if(n.isBuffer(e))return e;if(\"string\"==typeof e)return n.from(e,\"base64\");throw new TypeError(\"ECDSA signature must be a Base64 string or a Buffer\")}function f(e,r,t){for(var n=0;r+n<t&&0===e[r+n];)++n;return e[r+n]>=o&&--n,n}e.exports={derToJose:function(e,r){e=s(e);var t=i(r),f=t+1,c=e.length,l=0;if(e[l++]!==a)throw new Error('Could not find expected \"seq\"');var d=e[l++];if(d===(1|o)&&(d=e[l++]),c-l<d)throw new Error('\"seq\" specified length of \"'+d+'\", only \"'+(c-l)+'\" remaining');if(e[l++]!==u)throw new Error('Could not find expected \"int\" for \"r\"');var p=e[l++];if(c-l-2<p)throw new Error('\"r\" specified length of \"'+p+'\", only \"'+(c-l-2)+'\" available');if(f<p)throw new Error('\"r\" specified length of \"'+p+'\", max of \"'+f+'\" is acceptable');var h=l;if(l+=p,e[l++]!==u)throw new Error('Could not find expected \"int\" for \"s\"');var y=e[l++];if(c-l!==y)throw new Error('\"s\" specified length of \"'+y+'\", expected \"'+(c-l)+'\"');if(f<y)throw new Error('\"s\" specified length of \"'+y+'\", max of \"'+f+'\" is acceptable');var v=l;if((l+=y)!==c)throw new Error('Expected to consume entire buffer, but \"'+(c-l)+'\" bytes remain');var g=t-p,m=t-y,b=n.allocUnsafe(g+p+m+y);for(l=0;l<g;++l)b[l]=0;e.copy(b,l,h+Math.max(-g,0),h+p);for(var w=l=t;l<w+m;++l)b[l]=0;return e.copy(b,l,v+Math.max(-m,0),v+y),b=function(e){return e.replace(/=/g,\"\").replace(/\\+/g,\"-\").replace(/\\//g,\"_\")}(b=b.toString(\"base64\"))},joseToDer:function(e,r){e=s(e);var t=i(r),c=e.length;if(c!==2*t)throw new TypeError('\"'+r+'\" signatures must be \"'+2*t+'\" bytes, saw \"'+c+'\"');var l=f(e,0,t),d=f(e,t,e.length),p=t-l,h=t-d,y=2+p+1+1+h,v=y<o,g=n.allocUnsafe((v?2:3)+y),m=0;return g[m++]=a,v?g[m++]=y:(g[m++]=1|o,g[m++]=255&y),g[m++]=u,g[m++]=p,l<0?(g[m++]=0,m+=e.copy(g,m,0,t)):m+=e.copy(g,m,l,t),g[m++]=u,g[m++]=h,d<0?(g[m++]=0,e.copy(g,m,t)):e.copy(g,m,t+d),g}}},function(e,r,t){\"use strict\";function n(e){return(e/8|0)+(e%8==0?0:1)}var i={ES256:n(256),ES384:n(384),ES512:n(521)};e.exports=function(e){var r=i[e];if(r)return r;throw new Error('Unknown algorithm \"'+e+'\"')}},function(e,r,t){var n=t(23).Buffer,i=t(31),o=t(32),a=t(26),u=t(33),s=/^[a-zA-Z0-9\\-_]+?\\.[a-zA-Z0-9\\-_]+?\\.([a-zA-Z0-9\\-_]+)?$/;function f(e){if(function(e){return\"[object Object]\"===Object.prototype.toString.call(e)}(e))return e;try{return JSON.parse(e)}catch(e){return}}function c(e){var r=e.split(\".\",1)[0];return f(n.from(r,\"base64\").toString(\"binary\"))}function l(e){return e.split(\".\")[2]}function d(e){return s.test(e)&&!!c(e)}function p(e,r,t){if(!r){var n=new Error(\"Missing algorithm parameter for jws.verify\");throw n.code=\"MISSING_ALGORITHM\",n}var i=l(e=u(e)),a=function(e){return e.split(\".\",2).join(\".\")}(e);return o(r).verify(a,i,t)}function h(e,r){if(r=r||{},!d(e=u(e)))return null;var t=c(e);if(!t)return null;var i=function(e,r){r=r||\"utf8\";var t=e.split(\".\")[1];return n.from(t,\"base64\").toString(r)}(e);return(\"JWT\"===t.typ||r.json)&&(i=JSON.parse(i,r.encoding)),{header:t,payload:i,signature:l(e)}}function y(e){var r=(e=e||{}).secret||e.publicKey||e.key,t=new i(r);this.readable=!0,this.algorithm=e.algorithm,this.encoding=e.encoding,this.secret=this.publicKey=this.key=t,this.signature=new i(e.signature),this.secret.once(\"close\",function(){!this.signature.writable&&this.readable&&this.verify()}.bind(this)),this.signature.once(\"close\",function(){!this.secret.writable&&this.readable&&this.verify()}.bind(this))}t(22).inherits(y,a),y.prototype.verify=function(){try{var e=p(this.signature.buffer,this.algorithm,this.key.buffer),r=h(this.signature.buffer,this.encoding);return this.emit(\"done\",e,r),this.emit(\"data\",e),this.emit(\"end\"),this.readable=!1,e}catch(e){this.readable=!1,this.emit(\"error\",e),this.emit(\"close\")}},y.decode=h,y.isValid=d,y.verify=p,e.exports=y},function(e,r,t){var n=t(24),i=t(34),o=t(35),a=t(30),u=t(25),s=t(50),f=t(40);e.exports=function(e,r,t,c){var l;if(\"function\"!=typeof t||c||(c=t,t={}),t||(t={}),t=f(t),l=c?function(){var e=Array.prototype.slice.call(arguments,0);return process.nextTick(function(){c.apply(null,e)})}:function(e,r){if(e)throw e;return r},t.clockTimestamp&&\"number\"!=typeof t.clockTimestamp)return l(new n(\"clockTimestamp must be a number\"));var d=t.clockTimestamp||Math.floor(Date.now()/1e3);if(!e)return l(new n(\"jwt must be provided\"));if(\"string\"!=typeof e)return l(new n(\"jwt must be a string\"));var p=e.split(\".\");if(3!==p.length)return l(new n(\"jwt malformed\"));var h,y=\"\"!==p[2].trim();if(!y&&r)return l(new n(\"jwt signature is required\"));if(y&&!r)return l(new n(\"secret or public key must be provided\"));y||t.algorithms||(t.algorithms=[\"none\"]),t.algorithms||(t.algorithms=~r.toString().indexOf(\"BEGIN CERTIFICATE\")||~r.toString().indexOf(\"BEGIN PUBLIC KEY\")?[\"RS256\",\"RS384\",\"RS512\",\"ES256\",\"ES384\",\"ES512\"]:~r.toString().indexOf(\"BEGIN RSA PUBLIC KEY\")?[\"RS256\",\"RS384\",\"RS512\"]:[\"HS256\",\"HS384\",\"HS512\"]);try{h=u.decode(e)}catch(e){return l(e)}if(!h)return l(new n(\"invalid token\"));var v,g,m=h.header;if(!~t.algorithms.indexOf(m.alg))return l(new n(\"invalid algorithm\"));try{v=u.verify(e,m.alg,r)}catch(e){return l(e)}if(!v)return l(new n(\"invalid signature\"));try{g=a(e)}catch(e){return l(e)}if(void 0!==g.nbf&&!t.ignoreNotBefore){if(\"number\"!=typeof g.nbf)return l(new n(\"invalid nbf value\"));if(g.nbf>d+(t.clockTolerance||0))return l(new i(\"jwt not active\",new Date(1e3*g.nbf)))}if(void 0!==g.exp&&!t.ignoreExpiration){if(\"number\"!=typeof g.exp)return l(new n(\"invalid exp value\"));if(d>=g.exp+(t.clockTolerance||0))return l(new o(\"jwt expired\",new Date(1e3*g.exp)))}if(t.audience){var b=Array.isArray(t.audience)?t.audience:[t.audience];if(!(Array.isArray(g.aud)?g.aud:[g.aud]).some(function(e){return-1!=b.indexOf(e)}))return l(new n(\"jwt audience invalid. expected: \"+b.join(\" or \")))}if(t.issuer&&(\"string\"==typeof t.issuer&&g.iss!==t.issuer||Array.isArray(t.issuer)&&-1===t.issuer.indexOf(g.iss)))return l(new n(\"jwt issuer invalid. expected: \"+t.issuer));if(t.subject&&g.sub!==t.subject)return l(new n(\"jwt subject invalid. expected: \"+t.subject));if(t.jwtid&&g.jti!==t.jwtid)return l(new n(\"jwt jwtid invalid. expected: \"+t.jwtid));if(t.maxAge){var w=s(t.maxAge);if(\"number\"!=typeof g.iat)return l(new n(\"iat required when maxAge is specified\"));if((1e3*(t.clockTimestamp||0)||Date.now())-1e3*g.iat>w+1e3*(t.clockTolerance||0))return l(new o(\"maxAge exceeded\",new Date(1e3*g.iat+w)))}return l(null,g)}},function(e,r){e.exports=require(\"ms\")},function(e,r,t){var n=t(19),i=t(36),o=t(40),a=t(25),u=t(58),s=n.object().keys({expiresIn:[n.number().integer(),n.string()],notBefore:[n.number().integer(),n.string()],audience:[n.string(),n.array()],algorithm:n.string().valid(\"RS256\",\"RS384\",\"RS512\",\"ES256\",\"ES384\",\"ES512\",\"HS256\",\"HS384\",\"HS512\",\"none\"),header:n.object(),encoding:n.string(),issuer:n.string(),subject:n.string(),jwtid:n.string(),noTimestamp:n.boolean(),keyid:n.string()}),f=n.object().keys({iat:n.number(),exp:n.number(),nbf:n.number()}).unknown(),c={audience:\"aud\",issuer:\"iss\",subject:\"sub\",jwtid:\"jti\"},l=[\"expiresIn\",\"notBefore\",\"noTimestamp\",\"audience\",\"issuer\",\"subject\",\"jwtid\"];e.exports=function(e,r,t,n){\"function\"==typeof t?(n=t,t={}):t=t||{};var d=\"object\"==typeof e&&!Buffer.isBuffer(e),p=o({alg:t.algorithm||\"HS256\",typ:d?\"JWT\":void 0,kid:t.keyid},t.header);function h(e){if(n)return n(e);throw e}if(void 0===e)return h(new Error(\"payload is required\"));if(d){var y=f.validate(e);if(y.error)return h(y.error);e=o(e)}else{var v=l.filter(function(e){return void 0!==t[e]});if(v.length>0)return h(new Error(\"invalid \"+v.join(\",\")+\" option for \"+typeof e+\" payload\"))}if(void 0!==e.exp&&void 0!==t.expiresIn)return h(new Error('Bad \"options.expiresIn\" option the payload already has an \"exp\" property.'));if(void 0!==e.nbf&&void 0!==t.notBefore)return h(new Error('Bad \"options.notBefore\" option the payload already has an \"nbf\" property.'));var g=s.validate(t);if(g.error)return h(g.error);var m=e.iat||Math.floor(Date.now()/1e3);if(t.noTimestamp?delete e.iat:e.iat=m,void 0!==t.notBefore&&(e.nbf=i(t.notBefore),void 0===e.nbf))return h(new Error('\"notBefore\" should be a number of seconds or string representing a timespan eg: \"1d\", \"20h\", 60'));if(void 0!==t.expiresIn&&\"object\"==typeof e&&(e.exp=i(t.expiresIn,m),void 0===e.exp))return h(new Error('\"expiresIn\" should be a number of seconds or string representing a timespan eg: \"1d\", \"20h\", 60'));Object.keys(c).forEach(function(r){var n=c[r];if(void 0!==t[r]){if(void 0!==e[n])return h(new Error('Bad \"options.'+r+'\" option. The payload already has an \"'+n+'\" property.'));e[n]=t[r]}});var b=t.encoding||\"utf8\";if(\"function\"!=typeof n)return a.sign({header:p,payload:e,secret:r,encoding:b});n=n&&u(n),a.createSign({header:p,privateKey:r,payload:e,encoding:b}).once(\"error\",n).once(\"done\",function(e){n(null,e)})}},,,,,,,function(e,r){var t=\"Expected a function\",n=1/0,i=1.7976931348623157e308,o=NaN,a=\"[object Symbol]\",u=/^\\s+|\\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,f=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt,d=Object.prototype.toString;function p(e,r){var p;if(\"function\"!=typeof r)throw new TypeError(t);return e=function(e){var r=function(e){if(!e)return 0===e?e:0;if((e=function(e){if(\"number\"==typeof e)return e;if(function(e){return\"symbol\"==typeof e||function(e){return!!e&&\"object\"==typeof e}(e)&&d.call(e)==a}(e))return o;if(h(e)){var r=\"function\"==typeof e.valueOf?e.valueOf():e;e=h(r)?r+\"\":r}if(\"string\"!=typeof e)return 0===e?e:+e;e=e.replace(u,\"\");var t=f.test(e);return t||c.test(e)?l(e.slice(2),t?2:8):s.test(e)?o:+e}(e))===n||e===-n){var r=e<0?-1:1;return r*i}return e==e?e:0}(e),t=r%1;return r==r?t?r-t:r:0}(e),function(){return--e>0&&(p=r.apply(this,arguments)),e<=1&&(r=void 0),p}}function h(e){var r=typeof e;return!!e&&(\"object\"==r||\"function\"==r)}e.exports=function(e){return p(2,e)}},function(e,r,t){\"use strict\";var n=t(29),i=t(28),o={fromHeader:function(e){return function(r){var t=null;return r.headers[e]&&(t=r.headers[e]),t}},fromBodyField:function(e){return function(r){var t=null;return r.body&&Object.prototype.hasOwnProperty.call(r.body,e)&&(t=r.body[e]),t}},fromUrlQueryParameter:function(e){return function(r){var t=null,i=n.parse(r.url,!0);return i.query&&Object.prototype.hasOwnProperty.call(i.query,e)&&(t=i.query[e]),t}},fromAuthHeaderWithScheme:function(e){return function(r){var t=null;if(r.headers.authorization){var n=i.parse(r.headers.authorization);n&&e===n.scheme&&(t=n.value)}return t}},fromAuthHeader:function(){return o.fromAuthHeaderWithScheme(\"JWT\")},fromExtractors:function(e){if(!Array.isArray(e))throw new TypeError(\"extractors.fromExtractors expects an array\");return function(r){for(var t=null,n=0;!t&&n<e.length;)t=e[n].call(this,r),n++;return t}},versionOneCompatibility:function(e){var r=e.authScheme||\"JWT\",t=e.tokenBodyField||\"auth_token\",n=e.tokenQueryParameterName||\"auth_token\";return function(e){var i=o.fromAuthHeaderWithScheme(r)(e);i||(i=o.fromBodyField(t)(e));i||(i=o.fromUrlQueryParameter(n)(e));return i}}};e.exports=o}]);","extractedComments":[]}