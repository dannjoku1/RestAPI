{"code":"module.exports=function(e){var r={};function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&\"object\"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,\"default\",{enumerable:!0,value:e}),2&r&&\"string\"!=typeof e)for(var i in e)t.d(n,i,function(r){return e[r]}.bind(null,i));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,\"a\",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p=\"\",t(t.s=4)}([function(e,r){e.exports=require(\"express\")},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0});const n={MONGO_URL:\"mongodb://localhost/restapi-dev\",JWT_SECRET:\"thisisasecret\"},i={MONGO_URL:\"mongodb://localhost/restapi-test\"},o={MONGO_URL:\"mongodb://localhost/restapi-prod\"},u={PORT:process.env.PORT||3e3};r.default=Object.assign({},u,function(e){switch(e){case\"development\":return n;case\"test\":return i;default:return o}}(\"production\"))},function(e,r){e.exports=require(\"mongoose\")},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0}),r.passwordReg=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(t(19));const i=r.passwordReg=/(?=.*\\d)(?=.*[a-z])(?=.*[A-Z]).{6,}/;r.default={signup:{email:n.default.string().email().required(),password:n.default.string().regex(i).required(),firstName:n.default.string().required(),lastName:n.default.string().required(),userName:n.default.string().required()}}},function(e,r,t){\"use strict\";var n=a(t(0)),i=a(t(1));t(5);var o=a(t(6)),u=a(t(12));function a(e){return e&&e.__esModule?e:{default:e}}const s=(0,n.default)();(0,o.default)(s),s.get(\"/\",(e,r)=>{r.send(\"Hello World\")}),(0,u.default)(s),s.listen(i.default.PORT,e=>{if(e)throw e;console.log(`\\n    Server is running on port: ${i.default.PORT}\\n    --------\\n    Running on production\\n    --------\\n    Let's get it!!\\n    `)})},function(e,r,t){\"use strict\";var n=o(t(2)),i=o(t(1));function o(e){return e&&e.__esModule?e:{default:e}}n.default.Promise=global.Promise;try{n.default.connect(i.default.MONGO_URL)}catch(e){n.default.createConnection(i.default.MONGO_URL)}n.default.connection.once(\"open\",()=>console.log(\"MongoDB Running\")).on(\"error\",e=>{throw e})},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0});var n=a(t(7)),i=(a(t(8)),a(t(9))),o=a(t(10)),u=a(t(11));function a(e){return e&&e.__esModule?e:{default:e}}r.default=(e=>{e.use((0,i.default)()),e.use((0,o.default)()),e.use(n.default.json()),e.use(n.default.urlencoded({extended:!0})),e.use(u.default.initialize())})},function(e,r){e.exports=require(\"body-parser\")},function(e,r){e.exports=require(\"morgan\")},function(e,r){e.exports=require(\"compression\")},function(e,r){e.exports=require(\"helmet\")},function(e,r){e.exports=require(\"passport\")},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(t(13)),i=t(20);r.default=(e=>{e.use(\"/api/v1/users\",n.default),e.get(\"/hello\",i.authJwt,(e,r)=>{r.send(\"This is a private route\")})})},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0});var n=t(0),i=s(t(14)),o=t(20),u=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}(t(15)),a=s(t(3));function s(e){return e&&e.__esModule?e:{default:e}}const f=new n.Router;f.post(\"/signup\",(0,i.default)(a.default.signup),u.signUp),f.post(\"/login\",o.authLocal,u.login),r.default=f},function(e,r){e.exports=require(\"express-validation\")},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0}),r.signUp=async function(e,r){try{const t=await n.default.create(e.body);return r.status(201).json(t)}catch(e){return r.status(500).json(e)}},r.login=function(e,r,t){return r.status(200).json(e.user),t()};var n=function(e){return e&&e.__esModule?e:{default:e}}(t(16))},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0});var n=t(2),i=s(n),o=s(t(17)),u=t(18),a=t(3);function s(e){return e&&e.__esModule?e:{default:e}}const f=new n.Schema({email:{type:String,unique:!0,required:[!0,\"Email is required!\"],trim:!0,validate:{validator:e=>o.default.isEmail(e),message:\"{VALUE} is not a valid email!\"}},firstName:{type:String,required:[!0,\"First name is required\"],trim:!0},lastName:{type:String,required:[!0,\"Last name is required\"],trim:!0},userName:{type:String,required:[!0,\"Username is required\"],trim:!0},password:{type:String,required:[!0,\"Password is required!\"],trim:!0,minlength:[6,\"Password need to be longer!\"],validate:{validator:e=>a.passwordReg.test(e),message:\"{VALUE} is not a valid password!\"}}});f.pre(\"save\",function(e){return this.isModified(\"password\")&&(this.password=this._hashPassword(this.password)),e()}),f.methods={_hashPassword:e=>(0,u.hashSync)(e),authenticateUser(e){return(0,u.compareSync)(e,this.password)}},r.default=i.default.model(\"User\",f)},function(e,r){e.exports=require(\"validator\")},function(e,r){e.exports=require(\"bcrypt-nodejs\")},function(e,r){e.exports=require(\"joi\")},function(e,r,t){\"use strict\";Object.defineProperty(r,\"__esModule\",{value:!0}),r.authJwt=r.authLocal=void 0;var n=s(t(11)),i=s(t(21)),o=t(37),u=s(t(16)),a=s(t(1));function s(e){return e&&e.__esModule?e:{default:e}}const f=new i.default({usernameField:\"email\"},async(e,r,t)=>{try{const n=await u.default.findOne({email:e});return n&&n.authenticateUser(r)?t(null,n):t(null,!1)}catch(e){return t(e,!1)}}),c={jwtFromRequest:o.ExtractJwt.fromAuthHeader(\"authorization\"),secretOrKey:a.default.JWT_SECRET},l=new o.Strategy(c,async(e,r)=>{try{const t=await u.default.findById(e._id);return r(null,t?t:!1)}catch(e){return r(e,!1)}});n.default.use(f),n.default.use(l);r.authLocal=n.default.authenticate(\"local\",{session:!1}),r.authJwt=n.default.authenticate(\"jwt\",{session:!1})},function(e,r){e.exports=require(\"passport-local\")},function(e,r){e.exports=require(\"util\")},function(e,r){e.exports=require(\"safe-buffer\")},function(e,r){var t=function(e,r){Error.call(this,e),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name=\"JsonWebTokenError\",this.message=e,r&&(this.inner=r)};(t.prototype=Object.create(Error.prototype)).constructor=t,e.exports=t},function(e,r,t){var n=t(43),i=t(48);r.ALGORITHMS=[\"HS256\",\"HS384\",\"HS512\",\"RS256\",\"RS384\",\"RS512\",\"ES256\",\"ES384\",\"ES512\"],r.sign=n.sign,r.verify=i.verify,r.decode=i.decode,r.isValid=i.isValid,r.createSign=function(e){return new n(e)},r.createVerify=function(e){return new i(e)}},function(e,r){e.exports=require(\"stream\")},function(e,r){e.exports=require(\"buffer\")},function(e,r,t){\"use strict\";var n=/(\\S+)\\s+(\\S+)/;e.exports={parse:function(e){if(\"string\"!=typeof e)return null;var r=e.match(n);return r&&{scheme:r[1],value:r[2]}}}},function(e,r){e.exports=require(\"url\")},function(e,r,t){var n=t(25);e.exports=function(e,r){r=r||{};var t=n.decode(e,r);if(!t)return null;var i=t.payload;if(\"string\"==typeof i)try{var o=JSON.parse(i);null!==o&&\"object\"==typeof o&&(i=o)}catch(e){}return!0===r.complete?{header:t.header,payload:i,signature:t.signature}:i}},function(e,r,t){var n=t(23).Buffer,i=t(26);function o(e){if(this.buffer=null,this.writable=!0,this.readable=!0,!e)return this.buffer=n.alloc(0),this;if(\"function\"==typeof e.pipe)return this.buffer=n.alloc(0),e.pipe(this),this;if(e.length||\"object\"==typeof e)return this.buffer=e,this.writable=!1,process.nextTick(function(){this.emit(\"end\",e),this.readable=!1,this.emit(\"close\")}.bind(this)),this;throw new TypeError(\"Unexpected data type (\"+typeof e+\")\")}t(22).inherits(o,i),o.prototype.write=function(e){this.buffer=n.concat([this.buffer,n.from(e)]),this.emit(\"data\",e)},o.prototype.end=function(e){e&&this.write(e),this.emit(\"end\",e),this.emit(\"close\"),this.writable=!1,this.readable=!1},e.exports=o},function(e,r,t){var n=t(44),i=t(23).Buffer,o=t(45),u=t(46),a=t(22),s=\"secret must be a string or buffer\",f=\"key must be a string or a buffer\",c=\"key must be a string, a buffer or an object\";function l(e){return e.replace(/=/g,\"\").replace(/\\+/g,\"-\").replace(/\\//g,\"_\")}function d(e){var r=[].slice.call(arguments,1),t=a.format.bind(a,e).apply(null,r);return new TypeError(t)}function p(e){return i.isBuffer(e)||\"string\"==typeof e}function h(e){return p(e)||(e=JSON.stringify(e)),e}function y(e){return function(r,t){if(!p(t))throw d(s);r=h(r);var n=o.createHmac(\"sha\"+e,t);return l((n.update(r),n.digest(\"base64\")))}}function v(e){return function(r,t,o){var u=y(e)(r,o);return n(i.from(t),i.from(u))}}function g(e){return function(r,t){if(!p(t)&&\"object\"!=typeof t)throw d(c);r=h(r);var n=o.createSign(\"RSA-SHA\"+e);return l((n.update(r),n.sign(t,\"base64\")))}}function b(e){return function(r,t,n){if(!p(n))throw d(f);r=h(r),t=function(e){var r=4-(e=e.toString()).length%4;if(4!==r)for(var t=0;t<r;++t)e+=\"=\";return e.replace(/\\-/g,\"+\").replace(/_/g,\"/\")}(t);var i=o.createVerify(\"RSA-SHA\"+e);return i.update(r),i.verify(n,t,\"base64\")}}function m(e){var r=g(e);return function(){var t=r.apply(null,arguments);return t=u.derToJose(t,\"ES\"+e)}}function w(e){var r=b(e);return function(t,n,i){return n=u.joseToDer(n,\"ES\"+e).toString(\"base64\"),r(t,n,i)}}function j(){return function(){return\"\"}}function x(){return function(e,r){return\"\"===r}}e.exports=function(e){var r={hs:y,rs:g,es:m,none:j},t={hs:v,rs:b,es:w,none:x},n=e.match(/^(RS|ES|HS)(256|384|512)$|^(none)$/i);if(!n)throw d('\"%s\" is not a valid algorithm.\\n  Supported algorithms are:\\n  \"HS256\", \"HS384\", \"HS512\", \"RS256\", \"RS384\", \"RS512\" and \"none\".',e);var i=(n[1]||n[3]).toLowerCase(),o=n[2];return{sign:r[i](o),verify:t[i](o)}}},function(e,r,t){var n=t(27).Buffer;e.exports=function(e){return\"string\"==typeof e?e:\"number\"==typeof e||n.isBuffer(e)?e.toString():JSON.stringify(e)}},function(e,r,t){var n=t(24),i=function(e,r){n.call(this,e),this.name=\"NotBeforeError\",this.date=r};(i.prototype=Object.create(n.prototype)).constructor=i,e.exports=i},function(e,r,t){var n=t(24),i=function(e,r){n.call(this,e),this.name=\"TokenExpiredError\",this.expiredAt=r};(i.prototype=Object.create(n.prototype)).constructor=i,e.exports=i},function(e,r,t){var n=t(50);e.exports=function(e,r){var t=r||Math.floor(Date.now()/1e3);if(\"string\"==typeof e){var i=n(e);if(void 0===i)return;return Math.floor(t+i/1e3)}return\"number\"==typeof e?t+e:void 0}},function(e,r,t){\"use strict\";var n=t(38),i=t(59);e.exports={Strategy:n,ExtractJwt:i}},function(e,r,t){var n=t(39),i=(t(28),t(22)),o=(t(29),t(40));function u(e,r){if(n.Strategy.call(this),this.name=\"jwt\",this._secretOrKeyProvider=e.secretOrKeyProvider,e.secretOrKey){if(this._secretOrKeyProvider)throw new TypeError(\"JwtStrategy has been given both a secretOrKey and a secretOrKeyProvider\");this._secretOrKeyProvider=function(r,t,n){n(null,e.secretOrKey)}}if(!this._secretOrKeyProvider)throw new TypeError(\"JwtStrategy requires a secret or key\");if(this._verify=r,!this._verify)throw new TypeError(\"JwtStrategy requires a verify callback\");if(this._jwtFromRequest=e.jwtFromRequest,!this._jwtFromRequest)throw new TypeError(\"JwtStrategy requires a function to retrieve jwt from requests (see option jwtFromRequest)\");this._passReqToCallback=e.passReqToCallback;var t=e.jsonWebTokenOptions||{};this._verifOpts=o({},t,{audience:e.audience,issuer:e.issuer,algorithms:e.algorithms,ignoreExpiration:!!e.ignoreExpiration})}i.inherits(u,n.Strategy),u.JwtVerifier=t(41),u.prototype.authenticate=function(e,r){var t=this,n=t._jwtFromRequest(e);if(!n)return t.fail(new Error(\"No auth token\"));this._secretOrKeyProvider(e,n,function(r,i){r?t.fail(r):u.JwtVerifier(n,i,t._verifOpts,function(r,n){if(r)return t.fail(r);var i=function(e,r,n){return e?t.error(e):r?t.success(r,n):t.fail(n)};try{t._passReqToCallback?t._verify(e,n,i):t._verify(n,i)}catch(e){t.error(e)}})})},e.exports=u},function(e,r){e.exports=require(\"passport-strategy\")},function(e,r){e.exports=function(e,r){if(null==e)throw new TypeError(\"Cannot convert undefined or null to object\");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t}},function(e,r,t){var n=t(42);e.exports=function(e,r,t,i){return n.verify(e,r,t,i)}},function(e,r,t){e.exports={decode:t(30),verify:t(49),sign:t(51),JsonWebTokenError:t(24),NotBeforeError:t(34),TokenExpiredError:t(35)}},function(e,r,t){var n=t(23).Buffer,i=t(31),o=t(32),u=t(26),a=t(33),s=t(22);function f(e,r){return n.from(e,r).toString(\"base64\").replace(/=/g,\"\").replace(/\\+/g,\"-\").replace(/\\//g,\"_\")}function c(e){var r=e.header,t=e.payload,n=e.secret||e.privateKey,i=e.encoding,u=o(r.alg),c=function(e,r,t){t=t||\"utf8\";var n=f(a(e),\"binary\"),i=f(a(r),t);return s.format(\"%s.%s\",n,i)}(r,t,i),l=u.sign(c,n);return s.format(\"%s.%s\",c,l)}function l(e){var r=e.secret||e.privateKey||e.key,t=new i(r);this.readable=!0,this.header=e.header,this.encoding=e.encoding,this.secret=this.privateKey=this.key=t,this.payload=new i(e.payload),this.secret.once(\"close\",function(){!this.payload.writable&&this.readable&&this.sign()}.bind(this)),this.payload.once(\"close\",function(){!this.secret.writable&&this.readable&&this.sign()}.bind(this))}s.inherits(l,u),l.prototype.sign=function(){try{var e=c({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit(\"done\",e),this.emit(\"data\",e),this.emit(\"end\"),this.readable=!1,e}catch(e){this.readable=!1,this.emit(\"error\",e),this.emit(\"close\")}},l.sign=c,e.exports=l},function(e,r,t){\"use strict\";var n=t(27).Buffer,i=t(27).SlowBuffer;function o(e,r){if(!n.isBuffer(e)||!n.isBuffer(r))return!1;if(e.length!==r.length)return!1;for(var t=0,i=0;i<e.length;i++)t|=e[i]^r[i];return 0===t}e.exports=o,o.install=function(){n.prototype.equal=i.prototype.equal=function(e){return o(this,e)}};var u=n.prototype.equal,a=i.prototype.equal;o.restore=function(){n.prototype.equal=u,i.prototype.equal=a}},function(e,r){e.exports=require(\"crypto\")},function(e,r,t){\"use strict\";var n=t(23).Buffer,i=t(47),o=128,u=48,a=2;function s(e){if(n.isBuffer(e))return e;if(\"string\"==typeof e)return n.from(e,\"base64\");throw new TypeError(\"ECDSA signature must be a Base64 string or a Buffer\")}function f(e,r,t){for(var n=0;r+n<t&&0===e[r+n];)++n;return e[r+n]>=o&&--n,n}e.exports={derToJose:function(e,r){e=s(e);var t=i(r),f=t+1,c=e.length,l=0;if(e[l++]!==u)throw new Error('Could not find expected \"seq\"');var d=e[l++];if(d===(1|o)&&(d=e[l++]),c-l<d)throw new Error('\"seq\" specified length of \"'+d+'\", only \"'+(c-l)+'\" remaining');if(e[l++]!==a)throw new Error('Could not find expected \"int\" for \"r\"');var p=e[l++];if(c-l-2<p)throw new Error('\"r\" specified length of \"'+p+'\", only \"'+(c-l-2)+'\" available');if(f<p)throw new Error('\"r\" specified length of \"'+p+'\", max of \"'+f+'\" is acceptable');var h=l;if(l+=p,e[l++]!==a)throw new Error('Could not find expected \"int\" for \"s\"');var y=e[l++];if(c-l!==y)throw new Error('\"s\" specified length of \"'+y+'\", expected \"'+(c-l)+'\"');if(f<y)throw new Error('\"s\" specified length of \"'+y+'\", max of \"'+f+'\" is acceptable');var v=l;if((l+=y)!==c)throw new Error('Expected to consume entire buffer, but \"'+(c-l)+'\" bytes remain');var g=t-p,b=t-y,m=n.allocUnsafe(g+p+b+y);for(l=0;l<g;++l)m[l]=0;e.copy(m,l,h+Math.max(-g,0),h+p);for(var w=l=t;l<w+b;++l)m[l]=0;return e.copy(m,l,v+Math.max(-b,0),v+y),m=function(e){return e.replace(/=/g,\"\").replace(/\\+/g,\"-\").replace(/\\//g,\"_\")}(m=m.toString(\"base64\"))},joseToDer:function(e,r){e=s(e);var t=i(r),c=e.length;if(c!==2*t)throw new TypeError('\"'+r+'\" signatures must be \"'+2*t+'\" bytes, saw \"'+c+'\"');var l=f(e,0,t),d=f(e,t,e.length),p=t-l,h=t-d,y=2+p+1+1+h,v=y<o,g=n.allocUnsafe((v?2:3)+y),b=0;return g[b++]=u,v?g[b++]=y:(g[b++]=1|o,g[b++]=255&y),g[b++]=a,g[b++]=p,l<0?(g[b++]=0,b+=e.copy(g,b,0,t)):b+=e.copy(g,b,l,t),g[b++]=a,g[b++]=h,d<0?(g[b++]=0,e.copy(g,b,t)):e.copy(g,b,t+d),g}}},function(e,r,t){\"use strict\";function n(e){return(e/8|0)+(e%8==0?0:1)}var i={ES256:n(256),ES384:n(384),ES512:n(521)};e.exports=function(e){var r=i[e];if(r)return r;throw new Error('Unknown algorithm \"'+e+'\"')}},function(e,r,t){var n=t(23).Buffer,i=t(31),o=t(32),u=t(26),a=t(33),s=/^[a-zA-Z0-9\\-_]+?\\.[a-zA-Z0-9\\-_]+?\\.([a-zA-Z0-9\\-_]+)?$/;function f(e){if(function(e){return\"[object Object]\"===Object.prototype.toString.call(e)}(e))return e;try{return JSON.parse(e)}catch(e){return}}function c(e){var r=e.split(\".\",1)[0];return f(n.from(r,\"base64\").toString(\"binary\"))}function l(e){return e.split(\".\")[2]}function d(e){return s.test(e)&&!!c(e)}function p(e,r,t){if(!r){var n=new Error(\"Missing algorithm parameter for jws.verify\");throw n.code=\"MISSING_ALGORITHM\",n}var i=l(e=a(e)),u=function(e){return e.split(\".\",2).join(\".\")}(e);return o(r).verify(u,i,t)}function h(e,r){if(r=r||{},!d(e=a(e)))return null;var t=c(e);if(!t)return null;var i=function(e,r){r=r||\"utf8\";var t=e.split(\".\")[1];return n.from(t,\"base64\").toString(r)}(e);return(\"JWT\"===t.typ||r.json)&&(i=JSON.parse(i,r.encoding)),{header:t,payload:i,signature:l(e)}}function y(e){var r=(e=e||{}).secret||e.publicKey||e.key,t=new i(r);this.readable=!0,this.algorithm=e.algorithm,this.encoding=e.encoding,this.secret=this.publicKey=this.key=t,this.signature=new i(e.signature),this.secret.once(\"close\",function(){!this.signature.writable&&this.readable&&this.verify()}.bind(this)),this.signature.once(\"close\",function(){!this.secret.writable&&this.readable&&this.verify()}.bind(this))}t(22).inherits(y,u),y.prototype.verify=function(){try{var e=p(this.signature.buffer,this.algorithm,this.key.buffer),r=h(this.signature.buffer,this.encoding);return this.emit(\"done\",e,r),this.emit(\"data\",e),this.emit(\"end\"),this.readable=!1,e}catch(e){this.readable=!1,this.emit(\"error\",e),this.emit(\"close\")}},y.decode=h,y.isValid=d,y.verify=p,e.exports=y},function(e,r,t){var n=t(24),i=t(34),o=t(35),u=t(30),a=t(36),s=t(25);e.exports=function(e,r,t,f){var c;if(\"function\"!=typeof t||f||(f=t,t={}),t||(t={}),t=Object.assign({},t),c=f||function(e,r){if(e)throw e;return r},t.clockTimestamp&&\"number\"!=typeof t.clockTimestamp)return c(new n(\"clockTimestamp must be a number\"));var l=t.clockTimestamp||Math.floor(Date.now()/1e3);if(!e)return c(new n(\"jwt must be provided\"));if(\"string\"!=typeof e)return c(new n(\"jwt must be a string\"));var d,p=e.split(\".\");if(3!==p.length)return c(new n(\"jwt malformed\"));try{d=u(e,{complete:!0})}catch(e){return c(e)}if(!d)return c(new n(\"invalid token\"));var h,y=d.header;if(\"function\"==typeof r){if(!f)return c(new n(\"verify must be called asynchronous if secret or public key is provided as a callback\"));h=r}else h=function(e,t){return t(null,r)};return h(y,function(r,u){if(r)return c(new n(\"error in secret or public key callback: \"+r.message));var f,h=\"\"!==p[2].trim();if(!h&&u)return c(new n(\"jwt signature is required\"));if(h&&!u)return c(new n(\"secret or public key must be provided\"));if(h||t.algorithms||(t.algorithms=[\"none\"]),t.algorithms||(t.algorithms=~u.toString().indexOf(\"BEGIN CERTIFICATE\")||~u.toString().indexOf(\"BEGIN PUBLIC KEY\")?[\"RS256\",\"RS384\",\"RS512\",\"ES256\",\"ES384\",\"ES512\"]:~u.toString().indexOf(\"BEGIN RSA PUBLIC KEY\")?[\"RS256\",\"RS384\",\"RS512\"]:[\"HS256\",\"HS384\",\"HS512\"]),!~t.algorithms.indexOf(d.header.alg))return c(new n(\"invalid algorithm\"));try{f=s.verify(e,d.header.alg,u)}catch(e){return c(e)}if(!f)return c(new n(\"invalid signature\"));var y=d.payload;if(void 0!==y.nbf&&!t.ignoreNotBefore){if(\"number\"!=typeof y.nbf)return c(new n(\"invalid nbf value\"));if(y.nbf>l+(t.clockTolerance||0))return c(new i(\"jwt not active\",new Date(1e3*y.nbf)))}if(void 0!==y.exp&&!t.ignoreExpiration){if(\"number\"!=typeof y.exp)return c(new n(\"invalid exp value\"));if(l>=y.exp+(t.clockTolerance||0))return c(new o(\"jwt expired\",new Date(1e3*y.exp)))}if(t.audience){var v=Array.isArray(t.audience)?t.audience:[t.audience];if(!(Array.isArray(y.aud)?y.aud:[y.aud]).some(function(e){return v.some(function(r){return r instanceof RegExp?r.test(e):r===e})}))return c(new n(\"jwt audience invalid. expected: \"+v.join(\" or \")))}if(t.issuer&&(\"string\"==typeof t.issuer&&y.iss!==t.issuer||Array.isArray(t.issuer)&&-1===t.issuer.indexOf(y.iss)))return c(new n(\"jwt issuer invalid. expected: \"+t.issuer));if(t.subject&&y.sub!==t.subject)return c(new n(\"jwt subject invalid. expected: \"+t.subject));if(t.jwtid&&y.jti!==t.jwtid)return c(new n(\"jwt jwtid invalid. expected: \"+t.jwtid));if(t.maxAge){if(\"number\"!=typeof y.iat)return c(new n(\"iat required when maxAge is specified\"));var g=a(t.maxAge,y.iat);if(void 0===g)return c(new n('\"maxAge\" should be a number of seconds or string representing a timespan eg: \"1d\", \"20h\", 60'));if(l>=g+(t.clockTolerance||0))return c(new o(\"maxAge exceeded\",new Date(1e3*g)))}return c(null,y)})}},function(e,r){e.exports=require(\"ms\")},function(e,r,t){var n=t(36),i=t(25),o=t(52),u=t(53),a=t(54),s=t(55),f=t(56),c=t(57),l=t(58),d={expiresIn:{isValid:function(e){return a(e)||c(e)},message:'\"expiresIn\" should be a number of seconds or string representing a timespan'},notBefore:{isValid:function(e){return a(e)||c(e)},message:'\"notBefore\" should be a number of seconds or string representing a timespan'},audience:{isValid:function(e){return c(e)||Array.isArray(e)},message:'\"audience\" must be a string or array'},algorithm:{isValid:o.bind(null,[\"RS256\",\"RS384\",\"RS512\",\"ES256\",\"ES384\",\"ES512\",\"HS256\",\"HS384\",\"HS512\",\"none\"]),message:'\"algorithm\" must be a valid string enum value'},header:{isValid:f,message:'\"header\" must be an object'},encoding:{isValid:c,message:'\"encoding\" must be a string'},issuer:{isValid:c,message:'\"issuer\" must be a string'},subject:{isValid:c,message:'\"subject\" must be a string'},jwtid:{isValid:c,message:'\"jwtid\" must be a string'},noTimestamp:{isValid:u,message:'\"noTimestamp\" must be a boolean'},keyid:{isValid:c,message:'\"keyid\" must be a string'},mutatePayload:{isValid:u,message:'\"mutatePayload\" must be a boolean'}},p={iat:{isValid:s,message:'\"iat\" should be a number of seconds'},exp:{isValid:s,message:'\"exp\" should be a number of seconds'},nbf:{isValid:s,message:'\"nbf\" should be a number of seconds'}};function h(e,r,t,n){if(!f(t))throw new Error('Expected \"'+n+'\" to be a plain object.');Object.keys(t).forEach(function(i){var o=e[i];if(o){if(!o.isValid(t[i]))throw new Error(o.message)}else if(!r)throw new Error('\"'+i+'\" is not allowed in \"'+n+'\"')})}var y={audience:\"aud\",issuer:\"iss\",subject:\"sub\",jwtid:\"jti\"},v=[\"expiresIn\",\"notBefore\",\"noTimestamp\",\"audience\",\"issuer\",\"subject\",\"jwtid\"];e.exports=function(e,r,t,o){\"function\"==typeof t?(o=t,t={}):t=t||{};var u=\"object\"==typeof e&&!Buffer.isBuffer(e),a=Object.assign({alg:t.algorithm||\"HS256\",typ:u?\"JWT\":void 0,kid:t.keyid},t.header);function s(e){if(o)return o(e);throw e}if(!r&&\"none\"!==t.algorithm)return s(new Error(\"secretOrPrivateKey must have a value\"));if(void 0===e)return s(new Error(\"payload is required\"));if(u){try{!function(e){h(p,!0,e,\"payload\")}(e)}catch(e){return s(e)}t.mutatePayload||(e=Object.assign({},e))}else{var f=v.filter(function(e){return void 0!==t[e]});if(f.length>0)return s(new Error(\"invalid \"+f.join(\",\")+\" option for \"+typeof e+\" payload\"))}if(void 0!==e.exp&&void 0!==t.expiresIn)return s(new Error('Bad \"options.expiresIn\" option the payload already has an \"exp\" property.'));if(void 0!==e.nbf&&void 0!==t.notBefore)return s(new Error('Bad \"options.notBefore\" option the payload already has an \"nbf\" property.'));try{!function(e){h(d,!1,e,\"options\")}(t)}catch(e){return s(e)}var c=e.iat||Math.floor(Date.now()/1e3);if(t.noTimestamp?delete e.iat:e.iat=c,void 0!==t.notBefore&&(e.nbf=n(t.notBefore,c),void 0===e.nbf))return s(new Error('\"notBefore\" should be a number of seconds or string representing a timespan eg: \"1d\", \"20h\", 60'));if(void 0!==t.expiresIn&&\"object\"==typeof e&&(e.exp=n(t.expiresIn,c),void 0===e.exp))return s(new Error('\"expiresIn\" should be a number of seconds or string representing a timespan eg: \"1d\", \"20h\", 60'));Object.keys(y).forEach(function(r){var n=y[r];if(void 0!==t[r]){if(void 0!==e[n])return s(new Error('Bad \"options.'+r+'\" option. The payload already has an \"'+n+'\" property.'));e[n]=t[r]}});var g=t.encoding||\"utf8\";if(\"function\"!=typeof o)return i.sign({header:a,payload:e,secret:r,encoding:g});o=o&&l(o),i.createSign({header:a,privateKey:r,payload:e,encoding:g}).once(\"error\",o).once(\"done\",function(e){o(null,e)})}},function(e,r){var t=1/0,n=9007199254740991,i=1.7976931348623157e308,o=NaN,u=\"[object Arguments]\",a=\"[object Function]\",s=\"[object GeneratorFunction]\",f=\"[object String]\",c=\"[object Symbol]\",l=/^\\s+|\\s+$/g,d=/^[-+]0x[0-9a-f]+$/i,p=/^0b[01]+$/i,h=/^0o[0-7]+$/i,y=/^(?:0|[1-9]\\d*)$/,v=parseInt;function g(e){return e!=e}function b(e,r){return function(e,r){for(var t=-1,n=e?e.length:0,i=Array(n);++t<n;)i[t]=r(e[t],t,e);return i}(r,function(r){return e[r]})}var m=Object.prototype,w=m.hasOwnProperty,j=m.toString,x=m.propertyIsEnumerable,S=function(e,r){return function(t){return e(r(t))}}(Object.keys,Object),O=Math.max;function E(e,r){var t=T(e)||function(e){return function(e){return P(e)&&R(e)}(e)&&w.call(e,\"callee\")&&(!x.call(e,\"callee\")||j.call(e)==u)}(e)?function(e,r){for(var t=-1,n=Array(e);++t<e;)n[t]=r(t);return n}(e.length,String):[],n=t.length,i=!!n;for(var o in e)!r&&!w.call(e,o)||i&&(\"length\"==o||q(o,n))||t.push(o);return t}function _(e){if(!function(e){var r=e&&e.constructor,t=\"function\"==typeof r&&r.prototype||m;return e===t}(e))return S(e);var r=[];for(var t in Object(e))w.call(e,t)&&\"constructor\"!=t&&r.push(t);return r}function q(e,r){return!!(r=null==r?n:r)&&(\"number\"==typeof e||y.test(e))&&e>-1&&e%1==0&&e<r}var T=Array.isArray;function R(e){return null!=e&&function(e){return\"number\"==typeof e&&e>-1&&e%1==0&&e<=n}(e.length)&&!function(e){var r=k(e)?j.call(e):\"\";return r==a||r==s}(e)}function k(e){var r=typeof e;return!!e&&(\"object\"==r||\"function\"==r)}function P(e){return!!e&&\"object\"==typeof e}e.exports=function(e,r,n,u){e=R(e)?e:function(e){return e?b(e,function(e){return R(e)?E(e):_(e)}(e)):[]}(e),n=n&&!u?function(e){var r=function(e){if(!e)return 0===e?e:0;if((e=function(e){if(\"number\"==typeof e)return e;if(function(e){return\"symbol\"==typeof e||P(e)&&j.call(e)==c}(e))return o;if(k(e)){var r=\"function\"==typeof e.valueOf?e.valueOf():e;e=k(r)?r+\"\":r}if(\"string\"!=typeof e)return 0===e?e:+e;e=e.replace(l,\"\");var t=p.test(e);return t||h.test(e)?v(e.slice(2),t?2:8):d.test(e)?o:+e}(e))===t||e===-t){var r=e<0?-1:1;return r*i}return e==e?e:0}(e),n=r%1;return r==r?n?r-n:r:0}(n):0;var a=e.length;return n<0&&(n=O(a+n,0)),function(e){return\"string\"==typeof e||!T(e)&&P(e)&&j.call(e)==f}(e)?n<=a&&e.indexOf(r,n)>-1:!!a&&function(e,r,t){if(r!=r)return function(e,r,t,n){for(var i=e.length,o=t+(n?1:-1);n?o--:++o<i;)if(r(e[o],o,e))return o;return-1}(e,g,t);for(var n=t-1,i=e.length;++n<i;)if(e[n]===r)return n;return-1}(e,r,n)>-1}},function(e,r){var t=\"[object Boolean]\",n=Object.prototype.toString;e.exports=function(e){return!0===e||!1===e||function(e){return!!e&&\"object\"==typeof e}(e)&&n.call(e)==t}},function(e,r){var t=1/0,n=1.7976931348623157e308,i=NaN,o=\"[object Symbol]\",u=/^\\s+|\\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,f=/^0o[0-7]+$/i,c=parseInt,l=Object.prototype.toString;function d(e){var r=typeof e;return!!e&&(\"object\"==r||\"function\"==r)}e.exports=function(e){return\"number\"==typeof e&&e==function(e){var r=function(e){if(!e)return 0===e?e:0;if((e=function(e){if(\"number\"==typeof e)return e;if(function(e){return\"symbol\"==typeof e||function(e){return!!e&&\"object\"==typeof e}(e)&&l.call(e)==o}(e))return i;if(d(e)){var r=\"function\"==typeof e.valueOf?e.valueOf():e;e=d(r)?r+\"\":r}if(\"string\"!=typeof e)return 0===e?e:+e;e=e.replace(u,\"\");var t=s.test(e);return t||f.test(e)?c(e.slice(2),t?2:8):a.test(e)?i:+e}(e))===t||e===-t){var r=e<0?-1:1;return r*n}return e==e?e:0}(e),p=r%1;return r==r?p?r-p:r:0}(e)}},function(e,r){var t=\"[object Number]\",n=Object.prototype.toString;e.exports=function(e){return\"number\"==typeof e||function(e){return!!e&&\"object\"==typeof e}(e)&&n.call(e)==t}},function(e,r){var t=\"[object Object]\";var n=Function.prototype,i=Object.prototype,o=n.toString,u=i.hasOwnProperty,a=o.call(Object),s=i.toString,f=function(e,r){return function(t){return e(r(t))}}(Object.getPrototypeOf,Object);e.exports=function(e){if(!function(e){return!!e&&\"object\"==typeof e}(e)||s.call(e)!=t||function(e){var r=!1;if(null!=e&&\"function\"!=typeof e.toString)try{r=!!(e+\"\")}catch(e){}return r}(e))return!1;var r=f(e);if(null===r)return!0;var n=u.call(r,\"constructor\")&&r.constructor;return\"function\"==typeof n&&n instanceof n&&o.call(n)==a}},function(e,r){var t=\"[object String]\",n=Object.prototype.toString,i=Array.isArray;e.exports=function(e){return\"string\"==typeof e||!i(e)&&function(e){return!!e&&\"object\"==typeof e}(e)&&n.call(e)==t}},function(e,r){var t=\"Expected a function\",n=1/0,i=1.7976931348623157e308,o=NaN,u=\"[object Symbol]\",a=/^\\s+|\\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,f=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt,d=Object.prototype.toString;function p(e,r){var p;if(\"function\"!=typeof r)throw new TypeError(t);return e=function(e){var r=function(e){if(!e)return 0===e?e:0;if((e=function(e){if(\"number\"==typeof e)return e;if(function(e){return\"symbol\"==typeof e||function(e){return!!e&&\"object\"==typeof e}(e)&&d.call(e)==u}(e))return o;if(h(e)){var r=\"function\"==typeof e.valueOf?e.valueOf():e;e=h(r)?r+\"\":r}if(\"string\"!=typeof e)return 0===e?e:+e;e=e.replace(a,\"\");var t=f.test(e);return t||c.test(e)?l(e.slice(2),t?2:8):s.test(e)?o:+e}(e))===n||e===-n){var r=e<0?-1:1;return r*i}return e==e?e:0}(e),t=r%1;return r==r?t?r-t:r:0}(e),function(){return--e>0&&(p=r.apply(this,arguments)),e<=1&&(r=void 0),p}}function h(e){var r=typeof e;return!!e&&(\"object\"==r||\"function\"==r)}e.exports=function(e){return p(2,e)}},function(e,r,t){\"use strict\";var n=t(29),i=t(28),o={fromHeader:function(e){return function(r){var t=null;return r.headers[e]&&(t=r.headers[e]),t}},fromBodyField:function(e){return function(r){var t=null;return r.body&&Object.prototype.hasOwnProperty.call(r.body,e)&&(t=r.body[e]),t}},fromUrlQueryParameter:function(e){return function(r){var t=null,i=n.parse(r.url,!0);return i.query&&Object.prototype.hasOwnProperty.call(i.query,e)&&(t=i.query[e]),t}},fromAuthHeaderWithScheme:function(e){var r=e.toLowerCase();return function(e){var t=null;if(e.headers.authorization){var n=i.parse(e.headers.authorization);n&&r===n.scheme.toLowerCase()&&(t=n.value)}return t}},fromAuthHeaderAsBearerToken:function(){return o.fromAuthHeaderWithScheme(\"bearer\")},fromExtractors:function(e){if(!Array.isArray(e))throw new TypeError(\"extractors.fromExtractors expects an array\");return function(r){for(var t=null,n=0;!t&&n<e.length;)t=e[n].call(this,r),n++;return t}},versionOneCompatibility:function(e){var r=e.authScheme||\"JWT\",t=e.tokenBodyField||\"auth_token\",n=e.tokenQueryParameterName||\"auth_token\";return function(e){var i=o.fromAuthHeaderWithScheme(r)(e);i||(i=o.fromBodyField(t)(e));i||(i=o.fromUrlQueryParameter(n)(e));return i}}};e.exports=o}]);","extractedComments":[]}